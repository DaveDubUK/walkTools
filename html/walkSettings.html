<html>
    <head>
        <link rel="stylesheet" type="text/css" href="walkStyle.css">
        <script>
        
            var powerOn = true;
			var walkToolsOn = false;
            var animationSets = [];
            var currentAnimationSet = "Male";        

            function emitUpdate() {
                EventBridge.emitWebEvent(JSON.stringify({
                    type: "update",
                    armsFree: elArmsFree.checked,
                    makesFootStepSounds: elFootstepSounds.checked,
                    mixamoPreRotations: elMixamoPreRotations.checked,
                    animationSet: elAnimationCharacterSelect.value
                }));
            }
            
            function updateAnimationSets() {
                for (set in animationSets) {
                    var opt = animationSets[set];
                    var el = document.createElement("option");
                    el.textContent = opt;
                    el.value = opt;
                    elAnimationCharacterSelect.appendChild(el);
                }
                elAnimationCharacterSelect.value = currentAnimationSet; 
            }

            function loaded() {
                //elPower = document.getElementById("power");
                elArmsFree = document.getElementById("arms-free");
                elFootstepSounds = document.getElementById("footstep-sounds");
                elMixamoPreRotations = document.getElementById("mixamo-pre-rotations");
                elAnimationCharacterSelect = document.getElementById("animation-character-select");
				elWalkToolsButton = document.getElementById("walk-tools-button");
            

                // messages from walkSettings.js come in here
                if (window.EventBridge !== undefined) {
                    EventBridge.scriptEventReceived.connect(function(data) {
                        data = JSON.parse(data);

                        if (data.type == "update") {
                            if (data.armsFree !== undefined) {
                                elArmsFree.checked = data.armsFree;
                            }
                            if (data.makesFootStepSounds !== undefined) {
                                elFootstepSounds.checked = data.makesFootStepSounds;
                            }
                            if (data.mixamoPreRotations !== undefined) {
                                elMixamoPreRotations.checked = data.mixamoPreRotations;
                            }
                            if (data.animationSets !== undefined) { 
                                animationSets = [];
                                for (set in data.animationSets) {
                                    animationSets.push(data.animationSets[set]);
                                }
								animationSets.pop();
                                updateAnimationSets();
                                
                            }
                        }
                    });
                }
                elArmsFree.addEventListener("change", emitUpdate);
                elFootstepSounds.addEventListener("change", emitUpdate);
                elMixamoPreRotations.addEventListener("change", emitUpdate);
                elAnimationCharacterSelect.addEventListener("change", emitUpdate);
				elWalkToolsButton.addEventListener("click", function() {
                    walkToolsOn = !walkToolsOn;
					EventBridge.emitWebEvent(JSON.stringify({
						type: "walkToolsDisplay",
						walkToolsOn: walkToolsOn
					}));					
					
                });
              
                
                /*elPower.addEventListener("click", function() {
                    EventBridge.emitWebEvent(JSON.stringify({
                        type: "powerToggle"
                    }));
                    powerOn = !powerOn;
                    if (powerOn) {
                        elPower.value = "Turn Animation Off";
                    } else {
                        elPower.value = "Turn Animation On";
                    }
                });*/
                // request initial values
                EventBridge.emitWebEvent(JSON.stringify({ type: 'init' }));
            }
        </script>
    </head>
    <body onload='loaded();'>
        <div>
        
            <div id="walk-settings-header">        
            </div>        
            
            <div class="settings-section">
                <!--input type="button" id="power" value="Turn Animation Off" style="margin-left:30px; margin-top:10px; display:none;"></button-->
                <label>Character</label>
                <select class="editor-select-input" id="animation-character-select"></select>
            </div>            

            <div class="settings-section">
                <label>Arms free</label>
                <span>
                    <input type='checkbox' id="arms-free">
                </span>
            </div>

            <div class="settings-section">
                <label>Footstep sounds</label>
                <span>
                    <input type='checkbox' id="footstep-sounds">
                </span>
            </div>

            <div class="settings-section">
                <label>Mixamo pre-rotations</label>
                <span>
                    <input type='checkbox' id="mixamo-pre-rotations">
                </span>
            </div>

            <div class="settings-section">
				<div class="button-group">
					<input type="button" id="walk-tools-button" value="walkTools"></button>
				</div>
            </div>			

			</div>
    </body>
</html>
